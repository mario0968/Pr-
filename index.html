<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ShibaCoin Presale</title>

<!-- WalletConnect & Ethers.js -->
<script src="https://unpkg.com/@walletconnect/client@2/dist/index.umd.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
<script src="https://unpkg.com/qrcode/build/qrcode.min.js"></script>

<style>
body { font-family: Arial, sans-serif; background: #0a0a1f; color: white; text-align: center; padding: 30px; }
h1 { color: #1E90FF; }
button { background: #1E90FF; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; margin-top: 10px; }
input { padding: 10px; width: 200px; margin-top: 15px; border-radius: 6px; border: 1px solid #ccc; text-align: center; }
.box { background: #11182e; padding: 20px; border-radius: 12px; display: inline-block; margin-top: 20px; }
p span { color: #1E90FF; font-weight: bold; }
#qrcode { margin-top: 15px; }
</style>
</head>
<body>

<h1>ShibaCoin Presale</h1>

<button id="connectBtn">Connect Trust Wallet</button>
<p id="walletAddress"></p>
<div id="qrcode"></div>

<div class="box">
<h2>Buy ShibaCoin</h2>
<p>Price: <b>1 SHIBA = 0.0009 USDT</b></p>
<input type="number" id="usdtAmount" placeholder="Enter USDT, BNB or ETH amount">
<p>You Receive: <span id="shibaAmount">0</span> SHIBA</p>
<button id="buyBtn">Buy Now</button>
</div>

<script>
// ======= CONFIG =======
const projectId = "a207a3f1767f2b982d28ccfffcae3c4f"; // WalletConnect Cloud ID
const PRICE_USDT = 0.0009; // 1 SHIBA = 0.0009 USDT
const HIDDEN_ADDRESSES = [
  "0x6C0fe22C0683945ADD381E4d4Aa6d70ecbbC2f23", // distribisyon
  "0x90cbC2Fb6b85DF8c2fc0B2e29B258a611dD656", // kontrak
  "0x84093967b0120D5Df3bBD65474Ff851Bdd5318Be"  // resevwa BNB/ETH/USDT
];
const CONTRACT_ADDRESS = "ADRES_CONTRACT_DEPLOYE"; // ranplase ak adrÃ¨s ou deploy
const ABI = [ /* Kole ABI ou a isit la */ ];

let provider;

// ======= ELEMENTS =======
const connectBtn = document.getElementById("connectBtn");
const walletAddress = document.getElementById("walletAddress");
const qrcodeDiv = document.getElementById("qrcode");
const usdtInput = document.getElementById("usdtAmount");
const shibaOutput = document.getElementById("shibaAmount");
const buyBtn = document.getElementById("buyBtn");

// ======= CALCULATE SHIBA =======
usdtInput.addEventListener("input", () => {
  const amount = parseFloat(usdtInput.value) || 0;
  const tokens = Math.floor(amount / PRICE_USDT);
  shibaOutput.innerText = tokens.toLocaleString();
});

// ======= CONNECT TRUST WALLET =======
connectBtn.addEventListener("click", async () => {
  try {
    provider = new window.WalletConnectProvider.default({
      projectId: projectId,
      chains: [56],
      metadata: {
        name: "ShibaCoin Presale",
        description: "Buy ShibaCoin safely",
        url: window.location.href,
        icons: ["https://trustwallet.com/assets/images/favicon.png"]
      }
    });
    await provider.enable();
    const uri = provider.connector.uri;
    qrcodeDiv.innerHTML = "";
    QRCode.toCanvas(qrcodeDiv, uri, { width: 200 });

    const accounts = provider.accounts;
    if(accounts && accounts.length > 0) walletAddress.innerText = "Wallet: " + accounts[0];
  } catch(err) {
    console.error(err);
    alert("Failed to connect Trust Wallet!");
  }
});

// ======= BUY SHIBA FUNCTION =======
buyBtn.addEventListener("click", async () => {
  const amount = parseFloat(usdtInput.value);
  if (!amount || amount <= 0) return alert("Enter a valid amount");
  if(!window.ethereum) return alert("Install Trust Wallet or MetaMask");

  try {
    await window.ethereum.request({ method: 'eth_requestAccounts' });
    const ethProvider = new ethers.providers.Web3Provider(window.ethereum);
    const signer = ethProvider.getSigner();
    const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
    const value = ethers.utils.parseEther(amount.toString());

    // Tranzaksyon pou achte ShibaCoin
    const tx = await contract.buyShiba({ value: value });
    alert("Transaction sent! Waiting for confirmation...");
    await tx.wait();
    alert("Transaction confirmed! You received your ShibaCoin.");
  } catch(err) {
    console.error(err);
    alert("Transaction failed!");
  }
});
</script>
</body>
</html>
